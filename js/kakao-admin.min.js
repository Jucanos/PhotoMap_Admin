/*!
 * Start Bootstrap - PhotoMap_Admin v1.0.0 (https://github.com/RunaticMoon/PhotoMap_Admin#readme)
 * Copyright 2013-2020 RunaticMoon
 * Licensed under ISC (https://github.com/BlackrockDigital/photomap_admin_page/blob/master/LICENSE)
 */

Kakao.init("7600a0cf289a958df5021746c9222d59"),AWS.config.region="ap-northeast-2",AWS.config.credentials=new AWS.CognitoIdentityCredentials({IdentityPoolId:"ap-northeast-2:181ba321-7a7e-486d-9f43-3ac178405757",RoleArn:"arn:aws:iam::383760702031:role/Cognito_photoMapAdminCognitoUnauth_Role"});var ddb=new AWS.DynamoDB,athena=new AWS.Athena,date=new Date;function partition(t,e,o){return o?"year="+t+" and month="+e+" and day="+o:e?"year="+t+" and month="+e:t?"year="+t:"year="+date.getUTCFullYear().toString()+" and month="+(date.getUTCMonth()+1).toString()+" and day="+date.getUTCDate().toString()}var me,tableName="prod-photoMapTable",users=[];function createLoginButton(){Kakao.Auth.createLoginButton({container:"#kakao-login-btn",success:function(t){console.log("Login success",JSON.stringify(t)),Kakao.API.request({url:"/v2/user/me",success:function(t){"true"==t.properties.admin?window.location.replace("/admin/"):alert("관리자페이지에 접근할 권한이 없습니다."),console.log("user info success",JSON.stringify(t))},fail:function(t){alert("로그인이 실패했습니다."),console.log("user info error",JSON.stringify(t))}})},fail:function(t){alert("로그인이 실패했습니다."),console.log("Login error",JSON.stringify(t))}})}function getQuery(t,o){console.log(t+"() called"),"cardNumber"===t&&$("#standard").text(date.toLocaleDateString());var e={TableName:"queryTable",ExpressionAttributeValues:{":name":{S:t}},KeyConditionExpression:"queryName = :name"};ddb.query(e,function(t,e){t?console.log("Error",t):(console.log(e.Items[0].id.S),getStatus(e.Items[0].id.S,o))})}function get(t,e,o){return o?t.Data[e][o]:e?t.Data[e].VarCharValue:t.Data[0].VarCharValue}function getStatus(a,n){console.log("getStatus() called");var t={QueryExecutionId:a};athena.getQueryExecution(t,function(t,e){if(t)console.log(t,t.stack);else{console.log(e);var o=e.QueryExecution.Status.State;switch(console.log(o),o){case"QUEUED":case"RUNNING":setTimeout(getStatus,1e3,a,n);break;case"SUCCEEDED":getResult(a,n)}}})}function getResult(t,o){console.log("getResult() called");var e={QueryExecutionId:t};athena.getQueryResults(e,function(t,e){t?console.log(t,t.stack):(console.log(e),console.log(e.ResultSet.Rows),o&&(console.log("callback called"),o(e)))})}function logout(){Kakao.Auth.logout(),window.location.replace("/admin/login.html")}function uuid4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)})}function uuid(){var t=uuid4().split("-");return t[2]+t[1]+t[0]+t[3]+t[4]}function setCardNumber(t){for(var e=t.ResultSet.Rows,o=1;o<e.length;o++)$("#"+get(e[o],0)+"Number").text(get(e[o],1))}function setUserChart(t){for(var e=t.ResultSet.Rows,o=document.getElementById("UserChart"),a=[],n=[],r=1;r<e.length;r++)a.push(get(e[r],1)+"."+get(e[r],2)+"."+get(e[r],3)),n.push(Number(get(e[r],0)));new Chart(o,{type:"line",data:{labels:a,datasets:[{label:"유저수",lineTension:.3,backgroundColor:"rgba(78, 115, 223, 0.05)",borderColor:"rgba(78, 115, 223, 1)",pointRadius:3,pointBackgroundColor:"rgba(78, 115, 223, 1)",pointBorderColor:"rgba(78, 115, 223, 1)",pointHoverRadius:3,pointHoverBackgroundColor:"rgba(78, 115, 223, 1)",pointHoverBorderColor:"rgba(78, 115, 223, 1)",pointHitRadius:10,pointBorderWidth:2,data:n}]},options:{maintainAspectRatio:!1,layout:{padding:{left:10,right:25,top:25,bottom:0}},scales:{xAxes:[{time:{unit:"date"},gridLines:{display:!1,drawBorder:!1},ticks:{maxTicksLimit:7}}],yAxes:[{ticks:{beginAtZero:!0,maxTicksLimit:10,padding:10},gridLines:{color:"rgb(234, 236, 244)",zeroLineColor:"rgb(234, 236, 244)",drawBorder:!1,borderDash:[2],zeroLineBorderDash:[2]}}]},legend:{display:!1},tooltips:{backgroundColor:"rgb(255,255,255)",bodyFontColor:"#858796",titleMarginBottom:10,titleFontColor:"#6e707e",titleFontSize:14,borderColor:"#dddfeb",borderWidth:1,xPadding:15,yPadding:15,displayColors:!1,intersect:!1,mode:"index",caretPadding:10,callbacks:{label:function(t,e){return(e.datasets[t.datasetIndex].label||"")+": "+t.yLabel}}}}})}function setDataTable(t){console.log("setDataTable() called");var e=t.ResultSet.Rows;console.log(e);var o=e[0].Data.length;console.log(o);for(var a="",n=[],r=0;r<o-3;r++)n.push({data:"Data."+r+".VarCharValue"}),a+="<th>"+get(e[0],r)+"</th>";console.log(n),$("#dataTable").append("<thead>    <tr>    "+a+"    </tr>  </thead>  <tfoot>    <tr>    "+a+"    </tr>  </tfoot>"),e.splice(0,1);var l=$("#dataTable").DataTable({data:e,columns:n}).order([o-5,"desc"]).draw();console.log(l)}function getNotice(){console.log("getNotice() called");ddb.scan({TableName:"noticeTable"},function(t,e){if(t)console.log("Error",t);else{console.log(e.Items);var a=$("#noticeTable").DataTable({data:e.Items,columns:[{data:"id.S"},{data:"title.S"},{data:"context.S"},{data:"createdAt.N"},{data:"updatedAt.N"},{data:null}],columnDefs:[{targets:-1,data:null,defaultContent:'<button class="text-danger">X</button>'}]}).order([3,"desc"]).draw();$("#noticeTable tbody").on("click","button",function(){var o=a.row($(this).parents("tr")),t={TableName:"noticeTable",Key:{id:{S:o.data().id.S}}};ddb.deleteItem(t,function(t,e){t?console.log("Error",t):(o.remove(),o.draw())})})}})}function addNotice(){console.log("addNotice() called");var t=$("#title").val(),e=$("#context").val(),o=Date.now().toString(),a={TableName:"noticeTable",Item:{id:{S:uuid()},title:{S:t},context:{S:e},createdAt:{N:o},updatedAt:{N:o}}};$("#title").val(""),$("#context").val(""),ddb.putItem(a,function(t,e){t?console.log("Error",t):(console.log(e),$("#noticeTable").DataTable().row.add(a.Item).order([3,"desc"]).draw())})}$(function(){Kakao.Auth.getStatusInfo(function(t){console.log(t),"connected"==t.status?"true"!=t.user.properties.admin?(alert("관리자페이지에 접근할 권한이 없습니다."),Kakao.Auth.logout(),window.location.replace("/admin/login.html")):(console.log("success Login"),me=t.user,$("#userDropdown > span").text(me.kakao_account.profile.nickname),$("#userDropdown > img").attr("src",me.kakao_account.profile.thumbnail_image_url)):(alert("로그인이 필요합니다."),window.location.replace("/admin/login.html"))})});