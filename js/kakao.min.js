/*!
 * Start Bootstrap - PhotoMap_Admin v1.0.0 (https://github.com/RunaticMoon/PhotoMap_Admin#readme)
 * Copyright 2013-2020 RunaticMoon
 * Licensed under ISC (https://github.com/BlackrockDigital/photomap_admin_page/blob/master/LICENSE)
 */

Kakao.init("7600a0cf289a958df5021746c9222d59"),AWS.config.region="ap-northeast-2",AWS.config.credentials=new AWS.CognitoIdentityCredentials({IdentityPoolId:"ap-northeast-2:9293a76a-bac4-4910-9e12-d72bde2351ed"});var me,ddb=new AWS.DynamoDB,tableName="dev-photoMapTable",users=[];function createLoginButton(){Kakao.Auth.createLoginButton({container:"#kakao-login-btn",success:function(e){console.log("Login success",JSON.stringify(e)),Kakao.API.request({url:"/v2/user/me",success:function(e){"true"==e.properties.admin?window.location.replace("/"):alert("관리자페이지에 접근할 권한이 없습니다."),console.log("user info success",JSON.stringify(e))},fail:function(e){alert("로그인이 실패했습니다."),console.log("user info error",JSON.stringify(e))}})},fail:function(e){alert("로그인이 실패했습니다."),console.log("Login error",JSON.stringify(e))}})}function setAdmin(e,o){1==o||0==o||"true"==o||"false"==o?Kakao.API.request({url:"/v1/user/update_profile",data:{properties:{admin:o}},success:function(e){console.log(JSON.stringify(e))},fail:function(e){console.log(JSON.stringify(e))}}):console.log("setAdmin's isAdmin is invalid",o)}function getUserInfo(){console.log("getUserInfo() called");var e={TableName:tableName,IndexName:"GSI",ExpressionAttributeValues:{":info":{S:"INFO"},":user":{S:"USER"}},KeyConditionExpression:"SK = :info and types = :user"};ddb.query(e,function(e,o){e?console.log("Error",e):(users=o.Items,$("#userNumber").text(users.length))})}function getNotice(){console.log("getNotice() called");ddb.scan({TableName:"noticeTable"},function(e,o){if(e)console.log("Error",e);else{console.log(o.Items);var n=$("#noticeTable").DataTable({data:o.Items,columns:[{data:"id.S"},{data:"title.S"},{data:"context.S"},{data:"createdAt.S"},{data:"updatedAt.S"},{data:null}],columnDefs:[{targets:-1,data:null,defaultContent:'<button class="text-danger">X</button>'}]});$("#noticeTable tbody").on("click","button",function(){var t=n.row($(this).parents("tr")),e={TableName:"noticeTable",Key:{id:{S:t.data().id.S}}};ddb.deleteItem(e,function(e,o){e?console.log("Error",e):(t.remove(),t.draw())})})}})}function addNotice(){console.log("addNotice() called");var e=$("#title").val(),o=$("#context").val(),t=(new Date).toISOString(),n={TableName:"noticeTable",Item:{id:{S:uuid()},title:{S:e},context:{S:o},createdAt:{S:t},updatedAt:{S:t}}};ddb.putItem(n,function(e,o){e?console.log("Error",e):console.log(o)})}function logout(){Kakao.Auth.logout(),window.location.replace("/login.html")}function uuid4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var o=16*Math.random()|0;return("x"==e?o:3&o|8).toString(16)})}function uuid(){var e=uuid4().split("-");return e[2]+e[1]+e[0]+e[3]+e[4]}$(function(){Kakao.Auth.getStatusInfo(function(e){console.log(e),"connected"==e.status?"true"!=e.user.properties.admin?(alert("관리자페이지에 접근할 권한이 없습니다."),Kakao.Auth.logout(),window.location.replace("/login.html")):(console.log("success Login"),me=e.user,$("#userDropdown > span").text(me.kakao_account.profile.nickname),$("#userDropdown > img").attr("src",me.kakao_account.profile.thumbnail_image_url),getUserInfo()):(alert("로그인이 필요합니다."),window.location.replace("/login.html"))})});